<!--
 * This file is part of a plugin for Goobi - a Workflow tool for the support of mass digitization.
 *
 * Visit the websites for more information.
 *          - https://goobi.io
 *          - https://www.intranda.com
 *          - https://github.com/intranda/goobi
 *
 * This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free
 * Software Foundation; either version 2 of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59
 * Temple Place, Suite 330, Boston, MA 02111-1307 USA
 *
 -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:of="http://omnifaces.org/functions"
    template="/uii/template/template.html"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <ui:param name="myPageTitle"
        value="#{msgs.plugin}: #{msgs[('plugin_').concat(AktuelleSchritteForm.myPlugin.title)]}" />

    <ui:define name="breadcrumb">
        <intranda:breadcrumb label="#{msgs.startseite}" action="index"
            navId="a0" />

        <c:if
            test="#{LoginForm.hasRole('Workflow_Processes') and NavigationForm.uiStatus.pluginSimulation == true}">
            <intranda:breadcrumb id="processAll"
                label="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.aktuelleProzesse:msgs.prozessvorlagen}"
                action="process_all" navId="a1" />
            <intranda:breadcrumb id="processEdit"
                label="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.prozessDetails:msgs.process_templateDetails}"
                action="process_edit" />
        </c:if>

        <c:if test="#{NavigationForm.uiStatus.pluginSimulation != true}">
            <intranda:breadcrumb label="#{msgs.aktuelleSchritte}"
                action="#{AktuelleSchritteForm.paginator.returnToPreviousPage}" />
            <intranda:breadcrumb
                label="#{AktuelleSchritteForm.mySchritt.prozess.titel}"
                action="#{AktuelleSchritteForm.myPlugin.cancel}" />
        </c:if>

        <intranda:breadcrumb label="#{myPageTitle}"
            noSeparator="#{true}" />
    </ui:define>

    <ui:define name="info">
    </ui:define>

    <ui:define name="content">
        <main>
            <link rel="stylesheet" href="imageQA.css" />
<style>
/* Thumbnails */
.goobi-thumbnail {
	float: left;
	margin: 7px;
	width: var(--thumbnail-width);
    height: var(--thumbnail-height);
}
.goobi-thumbnail .goobi-thumbnail-image {
	float: left;
	width: 100%;
	min-height: 100px;
	overflow: hidden;
	max-height: var(--thumbnail-width);
}
</style>

            <script
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/reactiveX/rx.lite.min.js"></script>
            <script
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/q-promises/q.min.js"></script>

            <script
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/openseadragon/openseadragon.min.js"></script>
            <script
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/openseadragon/openseadragon-viewerinputhook.js"></script>

            <!-- 3D-Models -->
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/three.min.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/loaders/OBJLoader.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/loaders/MTLLoader.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/loaders/PLYLoader.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/loaders/STLLoader.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/loaders/FBXLoader.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/loaders/TDSLoader.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/loaders/DRACOLoader.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/loaders/GLTFLoader.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/controls/OrbitControls.js"></script>
            <script type="text/javascript"
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/three/dependencies/inflate.min.js"></script>
            <script
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/x3dom/x3dom.js"></script>

            <script
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/imageView.min.js"></script>
            <script
                src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/static/objectView.min.js"></script>

            <h:form id="qaform">

                <!-- BIG BOX -->
                <intranda:box
                    boxType="neutral"
                    boxTitle="false"
                    boxForm="false">

                    <!-- BOX TITLE WITH BUTTONS -->
                    <intranda:boxTitle
                        title="#{AktuelleSchritteForm.myPlugin.step.titel}"
                        icon="fa-puzzle-piece">

                        <div class="actions d-flex">

                            <!-- CHANGE FOLDER -->
                            <ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.possibleImageFolder.size() gt 1}">
                                <h:selectOneMenu
                                    id="folder"
                                    pt:aria-label="#{msgs.plugin_fileUpload_selectFolder}"
                                    styleClass="form-control"
                                    style="width:auto; display:inline-block"
                                    value="#{AktuelleSchritteForm.myPlugin.selectedImageFolder}">
                                    <f:selectItem
                                        itemValue=""
                                        itemLabel="#{msgs.bitteAuswaehlen}"
                                        itemDisabled="true" />
                                    <f:selectItems
                                        value="#{AktuelleSchritteForm.myPlugin.possibleImageFolder}"
                                        var="item"
                                        itemLabel="#{item}"
                                        itemValue="#{item}" />
                                </h:selectOneMenu>

                                <button
                                    class="btn d-flex align-items-center btn--title-action"
                                    jsf:id="changefolder"
                                    jsf:action="#{AktuelleSchritteForm.myPlugin.changeFolder}">
                                    <i class="fa fa-folder-open-o"></i>
                                    <span>
                                        <h:outputText value="#{msgs.plugin_fileUpload_changeFolder}" />
                                    </span>
                                </button>
                            </ui:fragment>
                            <!-- // CHANGE FOLDER -->

                             <!-- FULLSCREEN WITH JS BUTTON -->
                            <button
                                class="btn d-flex align-items-center btn--title-action"
                                title="#{msgs.imageFullscreen}"
                                jsf:action="ImageQAPlugin_JSFullscreen"
                                jsf:rendered="#{AktuelleSchritteForm.myPlugin.thumbnailsOnly and AktuelleSchritteForm.myPlugin.useJSFullscreen}">
                                <i class="fa fa-arrows-alt"></i>
                            </button>

                             <!-- REGULAR FULLSCREEN BUTTON -->
                            <button
                                class="btn d-flex align-items-center btn--title-action"
                                title="#{msgs.imageFullscreen}"
                                jsf:action="ImageQAPlugin_Fullscreen"
                                jsf:rendered="#{AktuelleSchritteForm.myPlugin.thumbnailsOnly and not AktuelleSchritteForm.myPlugin.useJSFullscreen}">
                                <i class="fa fa-arrows-alt"></i>
                            </button>

                            <!-- RELOAD BUTTON -->
                            <button jsf:id="id10"
                                aria-label="#{msgs.reload}"
                                jsf:action="#{NavigationForm.Reload}"
                                class="btn d-flex align-items-center btn--title-action">
                                <i class="fa fa-refresh" />
                            </button>

                             <!-- LEAVE AND FINISH TASK BUTTON -->
                            <button jsf:id="id11"
                                jsf:action="#{AktuelleSchritteForm.SchrittDurchBenutzerAbschliessen}"
                                class="btn d-flex align-items-center btn--title-action"
                                jsf:rendered="#{NavigationForm.uiStatus.pluginSimulation != true and AktuelleSchritteForm.myPlugin.allowTaskFinishButtons == true}"
                                title="#{msgs.task_leavePluginAndFinishTask}">
                                <i class="fa fa-check" />
                                <f:setPropertyActionListener
                                    target="#{NavigationForm.uiStatus.pluginSimulation}"
                                    value="#{false}" />
                            </button>

                             <!-- LEAVE BUTTON -->
                            <button jsf:id="id12"
                                jsf:action="#{AktuelleSchritteForm.myPlugin.cancel}"
                                class="btn d-flex align-items-center btn--title-action"
                                jsf:rendered="#{NavigationForm.uiStatus.pluginSimulation != true and AktuelleSchritteForm.myPlugin.allowTaskFinishButtons == true}"
                                title="#{msgs.pluginLeave}">
                                <i class="fa fa-close" />
                                <f:setPropertyActionListener
                                    target="#{NavigationForm.uiStatus.pluginSimulation}"
                                    value="#{false}" />
                            </button>

                        </div>
                    </intranda:boxTitle>
                    <!-- // BOX TITLE WITH BUTTONS -->

                    <div class="p-4">
                      <div class="row">


                        <!-- PLACEHOLDER FOR LEFT AND RIGHT AREA IF NO CONTENT WAS FOUND -->
                        <h:panelGroup layout="block"
                            rendered="#{AktuelleSchritteForm.myPlugin.sizeOfImageList == 0}"
                            styleClass="col-sm-12">
                            <h:outputText value="#{msgs.noImagesFound}" />
                        </h:panelGroup>
                        <!-- // PLACEHOLDER FOR LEFT AND RIGHT AREA IF NO CONTENT WAS FOUND -->


                        <!-- LEFT AREA FOR THUMBNAILS -->
                        <div
                            class="#{AktuelleSchritteForm.myPlugin.thumbnailsOnly ? 'col-sm-12' : AktuelleSchritteForm.myPlugin.displayOCR ? 'col-sm-5' : 'col-sm-7'} col-xs-12">
                            <h:panelGroup layout="block"
                                rendered="#{AktuelleSchritteForm.myPlugin.sizeOfImageList gt 0}">

                                <!-- THUMB PAGINATOR ON TOP -->
                                <div class="row">
                                    <f:subview id="first">
                                        <ui:include
                                            src="ImageQAPlugin_include_thumbnavigation.xhtml" />
                                    </f:subview>
                                </div>
                                <!-- // THUMB PAGINATOR ON TOP -->

                                <!-- LIST ALL THUMBNAILS ON THE LEFT -->
                                <div
                                    class="flex-container mt-5 mb-5"
                                    dir="#{AktuelleSchritteForm.myPlugin.flowDir}">

                                    <ui:repeat var="image"
                                        value="#{AktuelleSchritteForm.myPlugin.paginatorList}"
                                        varStatus="status">
                                            <div
                                                class="goobi-thumbnail #{AktuelleSchritteForm.myPlugin.image.imageName eq image.imageName?'img-active':'font-light'}"
                                                dir="auto"
                                                style="--thumbnail-width: #{AktuelleSchritteForm.myPlugin.thumbnailSize +2}px; --thumbnail-height: #{AktuelleSchritteForm.myPlugin.thumbnailSize + 55}px;">
                                                <div class="goobi-thumbnail-image">

                                                    <!-- THUMBNAIL DISPLAY -->
                                                    <div class="thumb text-center">

                                                        <button
                                                            jsf:id="imageClick"
                                                            class="border-0 btn"
                                                            title="#{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.imageClick}">
                                                            <ui:fragment rendered="#{image.type == 'image'}">
                                                                <canvas
                                                                    class="thumb-canvas"
                                                                    data-image_small="#{image.thumbnailUrl}"
                                                                    data-image_large="#{image.largeThumbnailUrl}"
                                                                    title="#{image.tooltip}"
                                                                    id="thumbnail-#{status.index}"></canvas>

                                                            </ui:fragment>

                                                            <!-- 3D OBJECT -->
                                                            <ui:fragment
                                                                rendered="#{image.type == 'object' or image.type == 'x3dom'}">
                                                                <img
                                                                    class="thumbnails__thumb-placeholder"
                                                                    src="#{HelperForm.servletPathWithHostAsUrl}/uii/template/img/goobi_3d_object_placeholder.png" />
                                                            </ui:fragment>

                                                            <!-- VIDEO -->
                                                            <ui:fragment
                                                                rendered="#{image.type == 'video'}">
                                                                <img
                                                                    class="thumbnails__thumb-placeholder"
                                                                    src="#{HelperForm.servletPathWithHostAsUrl}/uii/template/img/goobi_placeholder_video.png" />
                                                            </ui:fragment>

                                                            <!-- AUDIO -->
                                                            <ui:fragment
                                                                rendered="#{image.type == 'audio'}">
                                                                <img
                                                                    class="thumbnails__thumb-placeholder"
                                                                    src="#{HelperForm.servletPathWithHostAsUrl}/uii/template/img/goobi_placeholder_audio.png" />
                                                            </ui:fragment>

                                                            <!-- PLACEHOLDER -->
                                                            <ui:fragment
                                                                rendered="#{image.type != 'image' and image.type != 'object' and image.type != 'x3dom' and image.type != 'video' and image.type != 'audio'}">
                                                                <img
                                                                    class="thumbnails__thumb-placeholder"
                                                                    src="#{HelperForm.servletPathWithHostAsUrl}/uii/template/img/thumbnail-placeholder.png" />
                                                            </ui:fragment>
                                                            <f:setPropertyActionListener
                                                                value="#{image.order -1}"
                                                                target="#{AktuelleSchritteForm.myPlugin.imageIndex}" />
                                                            <f:ajax
                                                                execute="@form"
                                                                render="@form :qaform:bigimage"
                                                                onevent="freeJSResources"
                                                                disabled="#{AktuelleSchritteForm.myPlugin.thumbnailsOnly}" />
                                                        </button>
                                                    </div>
                                                    <!-- // THUMBNAIL DISPLAY -->


                                                </div>

                                                <!-- CAPTION FOR THUMB -->
                                                <div class="goobi-thumbnail-caption">
                                                    <h:outputText value="#{image.imageNameShort}"></h:outputText>
                                                </div>

                                                <!-- BUTTONS UNDER THUMB WITHOUT CONFIRMATION-->
                                                <h:panelGroup
                                                    styleClass="goobi-thumbnail-controls"
                                                    rendered="#{NavigationForm.uiStatus.plugin_qa_confirmation == false}">

                                                    <div class="goobi-thumbnail-controls-left">

                                                        <!-- CHECKBOX FOR SELECTION -->
                                                        <h:panelGroup
                                                            rendered="#{AktuelleSchritteForm.myPlugin.allowSelection}">
                                                            <span class="btn btn-blank thumbnail-control checkbox">
                                                                <label class="control checkbox"> <h:selectBooleanCheckbox
                                                                        value="#{image.selected}" /> <span
                                                                        class="control-indicator">
                                                                        <i class="fa fa fa-check-square-o"></i> <i
                                                                            class="fa fa fa-square-o"></i>
                                                                    </span>
                                                                </label>
                                                            </span>
                                                        </h:panelGroup>

                                                        <!--  MODAL FOR RENAMING  -->
                                                        <button
                                                                jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowRenaming}"
                                                                title="#{msgs.plugin_intranda_step_imageQA_rename} #{image.tooltip}"
                                                                class="btn btn-blank thumbnail-control rename"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#myModal-#{status.index}">
                                                            <i class="fa fa-pencil" />
                                                        </button>

                                                        <!--  REORDERING BUTTONS  -->
                                                        <button
                                                                class="btn btn-blank thumbnail-control reorder-previous"
                                                                title="#{msgs.plugin_intranda_step_imageQA_reorder_previous}"
                                                                jsf:action="#{AktuelleSchritteForm.myPlugin.reorderPrevious(image)}"
                                                                jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowReordering}">
                                                            <i class="fa fa-caret-left" />
                                                        </button>
                                                        <button
                                                                class="btn btn-blank thumbnail-control reorder-next"
                                                                title="#{msgs.plugin_intranda_step_imageQA_reorder_next}"
                                                                jsf:action="#{AktuelleSchritteForm.myPlugin.reorderNext(image)}"
                                                                jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowReordering}">
                                                            <i class="fa fa-caret-right" />
                                                        </button>

                                                        <!-- DELETE BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control delete"
                                                            title="#{msgs.plugin_intranda_step_imageQA_delete} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.deleteImage(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowDeletion}">
                                                            <i class="fa fa-trash"></i>
                                                        </button>
                                                    </div>

                                                    <div class="goobi-thumbnail-controls-right">

                                                        <!-- FLIP BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control flip-horizontal"
                                                            title="#{msgs.plugin_intranda_step_imageQA_flipHorizontal} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.flipHorizontal(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowFlipping}">
                                                            <i class="fa fa-arrows-h"></i>
                                                        </button>

                                                        <!-- FLOP BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control flip-vertical"
                                                            title="#{msgs.plugin_intranda_step_imageQA_flipVertical} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.flipVertical(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowFlipping}">
                                                            <i class="fa fa-arrows-v"></i>
                                                        </button>

                                                        <!-- ROTATE LEFT BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control rotate-left"
                                                            title="#{msgs.plugin_intranda_step_imageQA_rotateLeft} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.rotateLeft(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowRotation}">
                                                            <i class="fa fa-undo"></i>
                                                        </button>

                                                        <!-- ROTATE RIGHT BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control rotate-right"
                                                            title="#{msgs.plugin_intranda_step_imageQA_rotateRight} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.rotateRight(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowRotation}">
                                                            <i class="fa fa-repeat"></i>
                                                        </button>
                                                    </div>
                                                </h:panelGroup>
                                                <!-- // BUTTONS UNDER THUMB WITHOUT CONFIRMATION -->


                                                <!-- BUTTONS UNDER THUMB WITH CONFIRMATION -->
                                                <h:panelGroup
                                                    styleClass="goobi-thumbnail-controls"
                                                    rendered="#{NavigationForm.uiStatus.plugin_qa_confirmation != false}">
                                                    <div class="goobi-thumbnail-controls-left pull-left">

                                                        <!-- CHECKBOX FOR SELECTION -->
                                                        <h:panelGroup
                                                            rendered="#{AktuelleSchritteForm.myPlugin.allowSelection}">
                                                            <span class="btn btn-blank thumbnail-control checkbox">
                                                                <label class="control checkbox"> <h:selectBooleanCheckbox
                                                                        value="#{image.selected}" /> <span
                                                                        class="control-indicator">
                                                                        <i class="fa fa fa-check-square-o"></i> <i
                                                                            class="fa fa fa-square-o"></i>
                                                                    </span>
                                                                </label>

                                                            </span>
                                                        </h:panelGroup>

                                                        <!--  BUTTON FOR RENAMING INSIDE OF MODAL  -->
                                                        <button
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowRenaming}"
                                                            type="button"
                                                            title="#{msgs.plugin_intranda_step_imageQA_rename} #{image.tooltip}"
                                                            class="btn btn-blank thumbnail-control rename"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#myModal-#{status.index}">
                                                          <i class="fa fa-pencil " />
                                                        </button>

                                                        <!--  REORDERING BUTTONS  -->
                                                        <button
                                                                class="btn btn-blank thumbnail-control reorder-previous"
                                                                title="#{msgs.plugin_intranda_step_imageQA_reorder_previous}"
                                                                jsf:action="#{AktuelleSchritteForm.myPlugin.reorderPrevious(image)}"
                                                                jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowReordering}"
                                                                onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                            <i class="fa fa-caret-left" />
                                                        </button>
                                                        <button
                                                                class="btn btn-blank thumbnail-control reorder-next"
                                                                title="#{msgs.plugin_intranda_step_imageQA_reorder_next}"
                                                                jsf:action="#{AktuelleSchritteForm.myPlugin.reorderNext(image)}"
                                                                jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowReordering}"
                                                                onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                            <i class="fa fa-caret-right" />
                                                        </button>

                                                        <!-- DELETE BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control delete"
                                                            title="#{msgs.plugin_intranda_step_imageQA_delete} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.deleteImage(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowDeletion}"
                                                            onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                            <i class="fa fa-trash"></i>
                                                        </button>
                                                    </div>

                                                    <div class="goobi-thumbnail-controls-right pull-right">

                                                        <!-- FLIP BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control flip-horizontal"
                                                            title="#{msgs.plugin_intranda_step_imageQA_flipHorizontal} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.flipHorizontal(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowFlipping}"
                                                            onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                            <i class="fa fa-arrows-h"></i>
                                                        </button>

                                                        <!-- FLOP BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control flip-vertical"
                                                            title="#{msgs.plugin_intranda_step_imageQA_flipVertical} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.flipVertical(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowFlipping}"
                                                            onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                            <i class="fa fa-arrows-v"></i>
                                                        </button>

                                                        <!-- ROTATE LEFT BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control rotate-left"
                                                            title="#{msgs.plugin_intranda_step_imageQA_rotateLeft} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.rotateLeft(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowRotation}"
                                                            onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                            <i class="fa fa-undo"></i>
                                                        </button>

                                                        <!-- ROTATE RIGHT BUTTON -->
                                                        <button
                                                            class="btn btn-blank thumbnail-control rotate-right"
                                                            title="#{msgs.plugin_intranda_step_imageQA_rotateRight} #{image.tooltip}"
                                                            jsf:action="#{AktuelleSchritteForm.myPlugin.rotateRight(image)}"
                                                            jsf:rendered="#{AktuelleSchritteForm.myPlugin.allowRotation}"
                                                            onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                            <i class="fa fa-repeat"></i>
                                                        </button>
                                                    </div>
                                                </h:panelGroup>
                                                <!-- BUTTONS UNDER THUMB WITH CONFIRMATION -->

                                            </div>


                                            <!-- MODAL TO BE SHOWN EVENTUALLY -->
                                            <div
                                                class="modal fade"
                                                id="myModal-#{status.index}"
                                                tabindex="-1"
                                                aria-labelledby="exampleModalLabel"
                                                aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">

                                                        <!-- MODAL HEADER -->
                                                        <div class="modal-header">
                                                            <h4
                                                                class="modal-title"
                                                                id="myModalLabel-#{status.index}">
                                                                <h:outputText
                                                                    value="#{msgs.plugin_intranda_step_imageQA_renameTitle}: #{image.imageName}" />
                                                            </h4>
                                                            <button
                                                                type="button"
                                                                class="btn-close"
                                                                data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                        </div>
                                                        <!-- // MODAL HEADER -->

                                                        <!-- MODAL BODY -->
                                                        <div class="modal-body">
                                                            <h:outputText
                                                                value="#{msgs.plugin_intranda_step_imageQA_renameDescription}" />
                                                            <div
                                                                class="row"
                                                                style="margin-top: 15px;">
                                                                <ui:repeat
                                                                    var="namePart"
                                                                    value="#{image.nameParts}">
                                                                    <h:inputText
                                                                        styleClass="form-control namePart"
                                                                        value="#{namePart.value}" />
                                                                </ui:repeat>
                                                            </div>
                                                        </div>
                                                        <!-- // MODAL BODY -->

                                                        <!-- MODAL FOOTER -->
                                                        <div class="modal-footer">

                                                            <button
                                                                type="button"
                                                                class="btn btn-blank"
                                                                data-bs-dismiss="modal">
                                                                <h:outputText value="#{msgs.abbrechen}" />
                                                            </button>

                                                            <button
                                                                jsf:action="#{AktuelleSchritteForm.myPlugin.renameImages(image)}"
                                                                title="#{msgs.uebernehmen}"
                                                                jsf:rel="tooltip"
                                                                class="btn btn-success">
                                                                <i class="fa fa-floppy-o"></i>
                                                                <span>
                                                                    <h:outputText value="#{msgs.uebernehmen}" />
                                                                </span>
                                                                <f:passThroughAttribute
                                                                    name="data-toggle"
                                                                    value="tooltip" />
                                                            </button>

                                                        </div>
                                                        <!-- // MODAL FOOTER -->
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- // MODAL TO BE SHOWN EVENTUALLY -->


                                        </ui:repeat>
                                </div>
                                <!-- // LIST ALL THUMBNAILS ON THE LEFT -->


                                <!-- THUMB PAGINATOR AT BOTTOM -->
                                <div class="row">
                                    <f:subview id="second">
                                        <ui:param name="position"
                                            value="second"></ui:param>
                                        <ui:include
                                            src="ImageQAPlugin_include_thumbnavigation.xhtml" />
                                    </f:subview>
                                </div>
                                <!-- // THUMB PAGINATOR AT BOTTOM -->

                            </h:panelGroup>
                        </div>
                        <!-- // LEFT AREA FOR THUMBNAILS -->


                        <!-- RIGHT AREA FOR BIG DISPLAY OF IMAGES, VIDEO, 3D AND AUDIO -->
                        <h:panelGroup
                            rendered="#{AktuelleSchritteForm.myPlugin.sizeOfImageList gt 0 and not AktuelleSchritteForm.myPlugin.thumbnailsOnly}"
                            class="#{AktuelleSchritteForm.myPlugin.displayOCR ? 'col-xs-12 col-sm-7' : 'col-xs-12 col-sm-5'}"
                            layout="block">
                            <h:panelGroup id="bigimage" layout="block">

                                <!-- PAGINATION FOR OBJECT ON TOP -->
                                <div class="d-flex flex-column align-items-center gap-2">
                                    <f:subview id="first_image">
                                        <ui:include
                                            src="ImageQAPlugin_include_imagenavigation.xhtml" />
                                    </f:subview>
                                    <ui:fragment
                                        rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'image'}">
                                        <ui:include
                                            src="ImageQAPlugin_include_imageControls.xhtml" />
                                    </ui:fragment>
                                    <ui:fragment
                                        rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'object'}">
                                        <ui:include
                                            src="ImageQAPlugin_include_objectControls.xhtml" />
                                    </ui:fragment>
                                </div>
                                <!-- // PAGINATION FOR OBJECT ON TOP -->

                                <!-- big image -->

                                <!-- AUDIO PLAYBACK -->
                                <ui:fragment
                                    rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'audio'}">
                                    <div
                                        class="row margin-top-most margin-bottom-most">
                                        <audio class="audioplayer"
                                            id="audioplayer"
                                            controls="true"
                                            played="length"
                                            preload="auto"
                                            src="#{AktuelleSchritteForm.myPlugin.image.objectUrl}">
                                        </audio>
                                    </div>
                                </ui:fragment>
                                <!-- // AUDIO PLAYBACK -->


                                <!-- VIDEO DISPLAY -->
                                <ui:fragment
                                    rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'video'}">
                                    <div
                                        class="row margin-top-most margin-bottom-most">
                                        <video class="videoplayer"
                                            id="videoplayer"
                                            controls="true"
                                            played="length"
                                            preload="auto"
                                            src="#{AktuelleSchritteForm.myPlugin.image.objectUrl}">
                                        </video>
                                    </div>
                                </ui:fragment>
                                <!-- // VIDEO DISPLAY -->


                                <!-- UNKNOWN TYPE -->
                                <ui:fragment
                                    rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'unknown'}">
                                    <div
                                        class="row margin-top-most margin-bottom-most">
                                        <p class="unknown_file_download">
                                            <h:outputText
                                                value="#{msgs.mets_downloadFile}" />
                                            <a
                                                href="#{AktuelleSchritteForm.myPlugin.image.objectUrl}"
                                                download="#{AktuelleSchritteForm.myPlugin.image.tooltip}">Download</a>
                                        </p>
                                    </div>
                                </ui:fragment>
                                <!-- // UNKNOWN TYPE -->


                                <!-- IMAGE AND OBJECT DISPLAY ON THE RIGHT -->
                                <ui:fragment
                                    rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'image' or AktuelleSchritteForm.myPlugin.image.type == 'object' }">

                                    <div class="row">
                                        <div class="#{AktuelleSchritteForm.myPlugin.displayOCR ? 'col-xs-12 col-sm-6' : ''}">
                                            <div class="div-image">

												<input
													type="hidden"
						                            id="persistenceId"
						                            value="#{AktuelleSchritteForm.myPlugin.title.concat('_').concat(AktuelleSchritteForm.myPlugin.process.id)}" />

                                                <!-- AJAX LOADER -->
                                                <div id="mainImage">
                                                    <div
                                                        id="ajaxloader_image">
                                                        <img
                                                            src="template/img/goobi/ajaxloader2.gif"
                                                            aria-label="#{msgs.image}" />
                                                    </div>
                                                </div>
                                                <!-- // AJAX LOADER -->


                                                <!-- PAGINATION FOR OBJECT AT BOTTOM -->
                                                <div class="d-flex justify-content-between mt-3">
                                                    <div class="flex-grow-1 d-flex justify-content-center">
                                                        <f:subview id="second_image">
                                                            <ui:include
                                                                src="ImageQAPlugin_include_imagenavigation.xhtml" />
                                                        </f:subview>
                                                    </div>
                                                    <div class="d-flex align-items-center font-light">
                                                        <h:outputText
                                                                value="#{AktuelleSchritteForm.myPlugin.image.imageName}" />
                                                    </div>
                                                </div>
                                                <!-- // PAGINATION FOR OBJECT AT BOTTOM -->


                                                <!-- IMAGE COMMENTS -->
                                                <div
                                                    id="imageCommentArea"
                                                    class="grow-wrap mt-3">
                                                    <!-- TEXTAREA -->
                                                    <h:inputTextarea
                                                        id="Comment"
                                                        style="height: 50px;"
                                                        rendered="#{AktuelleSchritteForm.myPlugin.showImageComments}"
                                                        styleClass="form-control"
                                                        value="#{AktuelleSchritteForm.myPlugin.commentPropertyForImage}"
                                                        disabled="false"
                                                        pt:placeholder="#{msgs.comment}"
                                                        readonly="false">
                                                        <f:ajax
                                                            execute="@form"
                                                            event="valueChange" />
                                                    </h:inputTextarea>
                                                </div>
                                                <!-- // IMAGE COMMENTS -->

                                            </div>
                                        </div>

                                        <!-- OCR RESULT -->
                                        <ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.displayOCR}">
                                            <div class="col-xs-12 col-sm-6 border">
                                                <div id="ocrText"
                                                    class="ocr-text">
                                                    <h:outputText
                                                        value="#{AktuelleSchritteForm.myPlugin.ocrText}"
                                                        escape="false">
                                                    </h:outputText>
                                                </div>
                                            </div>
                                        </ui:fragment>
                                        <!--  // OCR RESULT -->

                                    </div>

                                </ui:fragment>
                                <!-- // IMAGE AND OBJECT DISPLAY ON THE RIGHT -->

                                <script type="text/javascript">
                              		//<![CDATA[
                                    var configViewer = {
                                        global: {
                                            divId: 'mainImage',
                                            useTiles: #{AktuelleSchritteForm.myPlugin.useTiles},
                                            footerHeight: 0,
                                            adaptContainerHeight: true,
                                            zoomSlider: "#zoomSlider",
                                            zoomSliderHandle: "#zoomSlider .zoom-slider-handle",
                                            zoomSliderLabel: "#zoomSliderLabel input",
                                            webApiToken: '#{AktuelleSchritteForm.myPlugin.imageWebApiToken}',
                                            imageSizes: #{AktuelleSchritteForm.myPlugin.displaySizes},
                                            tileSizes: #{AktuelleSchritteForm.myPlugin.tileSize}
                                        },
                                        image: {
                                            mimeType: "image/jpeg",
                                            tileSource: "#{AktuelleSchritteForm.myPlugin.image.url}"
                                            // tileSource : [#{AktuelleSchritteForm.myPlugin.image.imageLevels}],
                                            // originalImageWidth: "#{AktuelleSchritteForm.myPlugin.image.size.width}",
                                            // originalImageHeight: "#{AktuelleSchritteForm.myPlugin.image.size.height}",
                                        }
                                    };

                                    var worldConfig = {
                                            controls: {
                                                xAxis: {
                                                    rotateLeft: '#rotate-left-x',
                                                    rotateRight: '#rotate-right-x'
                                                },
                                               yAxis: {
                                                    rotateLeft: '#rotate-left-y',
                                                    rotateRight: '#rotate-right-y'
                                                },
                                               zAxis: {
                                                    rotateLeft: '#rotate-left-z',
                                                    rotateRight: '#rotate-right-z'
                                                },
                                                position: {
                                                    reset: '#reset-position'
                                                },
                                                zoom: {
                                                    resetZoom: '#reset#zoom'
                                                }
                                            },
                                            container: {
                                                id: "mainImage"
                                            },
                                     };

                                    var mediaType = "#{AktuelleSchritteForm.myPlugin.image.type}";
                                    if(mediaType == "image") {

                                    	//init zoom persistence
                                    	let imageZoomPersistenzeId = $( '#persistenceId' ).val();
                                        if(#{AktuelleSchritteForm.myPlugin.persistZoom} && imageZoomPersistenzeId && imageZoomPersistenzeId.length > 0) {
                                            console.log("persist image zoom with id ", imageZoomPersistenzeId);
                                            configViewer.global.persistenceId = imageZoomPersistenzeId;
                                            configViewer.global.persistZoom =  true;
                                            configViewer.global.persistRotation = true;
                                        }

                                        var viewImage = new ImageView.Image( configViewer );
                                        viewImage.load()
                                        .then(function(image) {
                                            image.onFirstTileLoaded()
                                            .then(function() {
                                                $('#ajaxloader_image').fadeOut(800);
                                            })
                                            .catch(function() {
                                                $('#ajaxloader_image').fadeOut(800);
                                            })
                                        })
                                        .catch(function(error){
                                            console.error( 'Error opening image', error );
                                            $('#ajaxloader_image').fadeOut(800);
                                            $('#' + configViewer.global.divId).html( 'Failed to load image: "' + error + '"' );
                                        });

                                    } else if(mediaType == "object") {
                                       $('#ajaxloader_image').show();
                                        var world = WorldGenerator.create(worldConfig);
                                        world.loadObject({
                                             url: "#{AktuelleSchritteForm.myPlugin.image.objectUrl}",
                                             position: { x:0, y:0, z:-0 },
                                             rotation:  { x:0, y:0, z:0 },
                                             size:  10,
                                             material: {
                                                    color: 0x44bb33
                                                },
                                            focus: true,
                                            onTick: function(object, time) {
                                                if(object) {
                                                // object.rotation.set(0,  Math.PI/180 * time, 0);
                                                }
                                            }
                                         }).then(function(object) {
                                             $('#ajaxloader_image').fadeOut(2000);
                                            world.render();
                                         }).catch(function(error) {
                                            $('#ajaxloader_image').fadeOut(2000);
                                             console.err("failed to load: ", error);
                                         })

                                    } else if(mediaType == "x3dom") {
                                        var objectUrl = "#{AktuelleSchritteForm.myPlugin.image.objectUrl}";
                                       $('#ajaxloader_image').show();
                                            new X3DLoader().load($('#mainImage'), objectUrl,
                                                function(){
                                                    $('#ajaxloader_image').fadeOut(2000);
                                                    // console.log("loaded")
                                                },
                                               function(){
                                                    // console.log("progress");
                                                },
                                               function(error){
                                                   $('#ajaxloader_image').fadeOut(2000);
                                                   console.err("error", error);
                                                })
                                    }

                                     function freeJSResources(data) {
                                            if(!data || data.status == 'begin') {
                                                if(viewImage) {
                                                    // console.log("closing OpenSeadragon viewer");
                                                    viewImage.close();
                                                }
                                                if(world) {
                                                    // console.log("disposing 3d scene");
                                                    world.dispose();
                                                }
                                            }
                                        }
                                   		//]]>
                                    </script>
                            </h:panelGroup>
                        </h:panelGroup>
                        <!-- // RIGHT AREA FOR BIG DISPLAY OF IMAGES, VIDEO, 3D AND AUDIO -->


                      </div>
                    </div>
                </intranda:box>
                <!-- // BIG BOX -->


                <!-- ACTION AREA BELOW -->
                <div class="form-actions">

                    <!-- LEAVE PLUGIN AND FINISH THE TASK -->
                    <button class="btn btn-success me-auto"
                        jsf:id="finishAndClose"
                        jsf:rendered="#{NavigationForm.uiStatus.pluginSimulation != true and AktuelleSchritteForm.myPlugin.allowTaskFinishButtons == true}"
                        jsf:action="#{AktuelleSchritteForm.SchrittDurchBenutzerAbschliessen}">
                        <i class="fa fa-check"></i>
                        <span>
                            <h:outputText value="#{msgs.task_leavePluginAndFinishTask}" />
                        </span>
                        <f:setPropertyActionListener
                            target="#{NavigationForm.uiStatus.pluginSimulation}"
                            value="#{false}" />
                    </button>
                    <!-- // LEAVE PLUGIN AND FINISH THE TASK -->

                    <!-- LEAVE PLUGIN -->
                    <button
                        class="btn btn-primary"
                        jsf:id="absenden"
                        jsf:action="#{AktuelleSchritteForm.myPlugin.cancel}">
                        <i class="fa fa-close"></i>
                        <span>
                            <h:outputText value="#{msgs.pluginLeave}" />
                        </span>
                        <f:setPropertyActionListener
                            target="#{NavigationForm.uiStatus.pluginSimulation}"
                            value="#{false}" />
                    </button>
                    <!-- // LEAVE PLUGIN -->

                </div>
                <!-- // ACTION AREA BELOW -->

            </h:form>


            <script type="text/javascript">

        	window.onload = function() {
		    	loadImages();
		    }

			function loadThumbnails() {
				var height = parseInt('#{AktuelleSchritteForm.myPlugin.thumbnailSize}');
				if (height) {
		     		$('.goobi-thumbnail-image').css('height', (height + 25) + 'px');
		    		$('.goobi-thumbnail-image .thumb').css('max-height', height + 'px');
		    		$('.goobi-thumbnail-image .thumb canvas').css('max-height', height + 'px');
		    		$('.goobi-thumbnail-image').css('max-width', (height) + 'px');
				}
			}

			$( document ).ready(function() {
				loadThumbnails();
			});

			faces.ajax.addOnEvent(function(data) {
		    	var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
		      	switch (ajaxstatus) {
		        	case "success": // This is called when ajax response is successfully processed.
		            	loadImages();
		            	loadThumbnails();
		              	break;
		      		}
			});

			function copyValue(element, e) {
		    	console.log(element.id);
		    	console.log("data attr ", element.dataset.input);
		    	if(element.dataset.input) {
		    		document.querySelectorAll("[data-input='"+element.dataset.input+"']").forEach(input => input.value = element.value );
		    	} else if (element.id =='qaform:first:txtMoveTo2') {
		        	document.getElementById('qaform:second:txtMoveTo2').value = element.value;
		    	} else if (element.id =='qaform:second:txtMoveTo2'){
		        	document.getElementById('qaform:first:txtMoveTo2').value = element.value;
		    	} else if (element.id =='qaform:first_image:txtImageMoveTo2') {
		        	document.getElementById('qaform:second_image:txtImageMoveTo2').value = element.value;
		    	} else {
		        	document.getElementById('qaform:first_image:txtImageMoveTo2').value = element.value;
		    	}

			    var keycode;
				if (window.event)
					keycode = window.event.keyCode;
				else if (e)
					keycode = e.which;
				else
					return true;

				if (keycode == 13) {
					document.getElementById(element.id).nextSibling.click();
					return false;
				} else
					return true;
			}

			$(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+right', function() {
            	var myButton = document.getElementById("qaform:first_image:imageNext");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+left', function() {
            	var myButton = document.getElementById("qaform:first_image:imageBack");
            	if (myButton!=null) {
            		myButton.click();
            	}
            });

         	// Find the right method, call on correct element
            function launchFullScreen(element) {
              if(element.requestFullScreen) {
                element.requestFullScreen();
              } else if(element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
              } else if(element.webkitRequestFullScreen) {
                element.webkitRequestFullScreen();
              }
            }

	</script>

        </main>
    </ui:define>

</ui:composition>