<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:o="http://omnifaces.org/ui" xmlns:of="http://omnifaces.org/functions" template="/uii/template/template_blank.html" xmlns:x="http://myfaces.apache.org/tomahawk" xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites">

    <ui:define name="content">

		 <style>

			body {
				background:black;
			}
			
			#mainImage {
				border: none;
			    widht: 100%;
				height:98vh;
			}
			
			html, body {
				overflow-x: hidden;
			}

		</style>

        <script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/plugins/step/#{AktuelleSchritteForm.myPlugin.title}/javascript/rx.lite.min.js"></script>
        <script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/plugins/step/#{AktuelleSchritteForm.myPlugin.title}/javascript/q.min.js"></script>
        <script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/plugins/step/#{AktuelleSchritteForm.myPlugin.title}/javascript/openseadragon/openseadragon.min.js"></script>
        <script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/plugins/step/#{AktuelleSchritteForm.myPlugin.title}/javascript/openseadragon/openseadragon-viewerinputhook.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/plugins/step/#{AktuelleSchritteForm.myPlugin.title}/javascript/viewImage.js"></script>

        <h:form id="qaform" style="margin-top:-15px;">

			<!-- big image -->
			<div class="row margin-top-most margin-bottom-most" style="height:95vh;">
			    <h:panelGroup styleClass="div-image" layout="block">
			        <div id="mainImage" class="margin-bottom-regular" rendered="#{AktuelleSchritteForm.myPlugin.image != null}" />
			        <script type="text/javascript">
						var configViewer = {
						    global: {
						    	divId: 'mainImage',
						        useTiles: false,
						        footerHeight: 0,
						        adaptContainerHeight: false,
						        zoomSlider: "#zoomSlider"
						    },
						    image: {
						        mimeType: "image/jpeg",
							        tileSource : [#{AktuelleSchritteForm.myPlugin.image.imageLevels}],
						    }
						};									
						    viewImage.init( configViewer )
						    .then(function(osViewer) {
						    	console.info( 'viewer opened' );
						        //TODO: Hide loader?
						    })
						    .catch(function(error){
						        console.error( 'Error opening image', error );
						        $('#' + configViewer.global.divId).html( 'Failed to load image: "' + error + '"' );
						    });
                          </script>
			    </h:panelGroup>
			</div>
			<!-- // big image -->
				
				<!-- exit fullscreen -->
				<h:commandLink styleClass="btn btn-lightgrey" style="position:absolute;top:10px; right:10px;" 
					action="ImageQAPlugin" title="#{msgs.imageDefaultDisplay}" >
					<i class="fa fa-close"></i>
				</h:commandLink>
				
				<!-- previous image -->
				<h:commandLink id="imageBack" styleClass="btn btn-lightgrey font-size-s" title="#{msgs.lw_previousImage}"
					style="position:absolute;top:50vh; left:10px; height:50px;padding-top:17px;">
					<i class="fa fa-angle-left"></i>
					<f:ajax execute="@form" render="@form" />
					<x:updateActionListener value="#{AktuelleSchritteForm.myPlugin.imageIndex - 1}" property="#{AktuelleSchritteForm.myPlugin.imageIndex}" />
				</h:commandLink>
				
				<!-- next image -->
				<h:commandLink id="imageNext" styleClass="btn btn-lightgrey font-size-s" title="#{msgs.lw_nextImage}"
					style="position:absolute;top:50vh; right:10px; height:50px; padding-top:17px;">
					<i class="fa fa-angle-right"></i>
					<f:ajax execute="@form" render="@form" />
					<x:updateActionListener value="#{AktuelleSchritteForm.myPlugin.imageIndex + 1}" property="#{AktuelleSchritteForm.myPlugin.imageIndex}" />
				</h:commandLink>
				
				<!-- file name -->
				<h:outputText styleClass="font-light" style="position:absolute;bottom:10px; left:10px;" 
					value="#{AktuelleSchritteForm.myPlugin.image.imageName}" />
				
				<!-- image number -->
				<div style="position:absolute;bottom:10px; right:10px;">
	                <x:outputText id="txtImageMoveTo1" styleClass="font-light"
	                    value="#{AktuelleSchritteForm.myPlugin.imageIndex +1} #{msgs.von}  #{AktuelleSchritteForm.myPlugin.sizeOfImageList}"
	                    onclick="document.getElementById(this.id).nextSibling.style.display='inline';
	                    document.getElementById(this.id).style.display='none';  
	                    document.getElementById(this.id).nextSibling.focus(); 
	                    document.getElementById(this.id).nextSibling.select();" /> 
					<!-- jump to page -->
	                <x:inputText value="#{AktuelleSchritteForm.myPlugin.imageMoveTo}" style="display:none;font-size:9px;width:30px"
	                    required="true" id="txtImageMoveTo2"
	                    onblur="document.getElementById(this.id).style.display='none';document.getElementById(this.id).previousSibling.style.display='inline';"
	                    onkeypress="copyValue(this,event);" />
	                <x:commandButton action="#{NavigationForm.Reload}" value="go" style="display:none" />
				</div>
				
				<!-- first and last page -->				
				<div style="position:absolute;top:10px;left:10px;display:none;">
					<h:commandLink styleClass="btn btn-lightgrey font-size-s margin-right-10" title="#{msgs.firstImage}">
						<i class="fa fa-double-angle-left"></i>
						<f:ajax execute="@form" render="@form" />
						<x:updateActionListener value="0" property="#{AktuelleSchritteForm.myPlugin.imageIndex}" />
					</h:commandLink>
					<h:commandLink styleClass="btn btn-lightgrey font-size-s" title="#{msgs.lastImage}">
						<i class="fa fa-double-angle-right"></i>
						<f:ajax execute="@form" render="@form" />
						<x:updateActionListener value="#{AktuelleSchritteForm.myPlugin.sizeOfImageList - 1}" property="#{AktuelleSchritteForm.myPlugin.imageIndex}" />
					</h:commandLink>
				</div>

		</h:form>


        <script type="text/javascript">
		     
        	// Find the right method, call on correct element
	        function launchIntoFullscreen(element) {
	          if(element.requestFullscreen) {
	            element.requestFullscreen();
	          } else if(element.mozRequestFullScreen) {
	            element.mozRequestFullScreen();
	          } else if(element.webkitRequestFullscreen) {
	            element.webkitRequestFullscreen();
	          } else if(element.msRequestFullscreen) {
	            element.msRequestFullscreen();
	          }
	        }
	
	       window.onload = function() {
		    	launchIntoFullscreen(document.documentElement); // the whole page
		    	loadImages();
		    }
		
			jsf.ajax.addOnEvent(function(data) {
			    var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
			      
			      switch (ajaxstatus) {
			          case "success": // This is called when ajax response is successfully processed.
			              loadImages();
			              break;
			      }
				
			});
			
			function copyValue(element, e) {
			    console.log(element.id);
			    if (element.id =='qaform:first:txtMoveTo2') {
			        document.getElementById('qaform:second:txtMoveTo2').value = element.value;
			    } else if (element.id =='qaform:second:txtMoveTo2'){
			        document.getElementById('qaform:first:txtMoveTo2').value = element.value;
			    } else if (element.id =='qaform:first_image:txtImageMoveTo2') {
			        document.getElementById('qaform:second_image:txtImageMoveTo2').value = element.value;
			    } else {
			        document.getElementById('qaform:first_image:txtImageMoveTo2').value = element.value;
			    }
			    
			    var keycode;
				if (window.event)
					keycode = window.event.keyCode;
				else if (e)
					keycode = e.which;
				else
					return true;
				
				if (keycode == 13) {
					document.getElementById(element.id).nextSibling.click();
					return false;
				} else
					return true;
			    
			}
		
			$(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+right', function() {            	
            	var myButton = document.getElementById("qaform:imageNext");
            	if (myButton!=null) {
            		myButton.click();
            	} 
            });
            
            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+left', function() {            	
            	var myButton = document.getElementById("qaform:imageBack");
            	if (myButton!=null) {
            		myButton.click();
            	} 
            });
			
		</script>
    </ui:define>

</ui:composition>