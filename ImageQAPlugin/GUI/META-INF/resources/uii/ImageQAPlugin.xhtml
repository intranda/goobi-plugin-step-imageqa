<!-- 
 * This file is part of a plugin for Goobi - a Workflow tool for the support of mass digitization.
 * 
 * Visit the websites for more information. 
 *          - https://goobi.io
 *          - https://www.intranda.com
 *          - https://github.com/intranda/goobi
 * 
 * This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free
 * Software Foundation; either version 2 of the License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59
 * Temple Place, Suite 330, Boston, MA 02111-1307 USA
 * 
 -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:o="http://omnifaces.org/ui" xmlns:of="http://omnifaces.org/functions" template="/uii/template/template.html" xmlns:x="http://myfaces.apache.org/tomahawk" xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites">

    <ui:param name="myPageTitle" value="#{msgs.plugin}: #{msgs[('plugin_').concat(AktuelleSchritteForm.myPlugin.title)]}" />

	<ui:define name="breadcrumb">
        <intranda:breadcrumb label="#{msgs.startseite}" action="index" navId="a0" />
        
        <c:if test="#{LoginForm.hasRole('Workflow_Processes') and NavigationForm.uiStatus.pluginSimulation == true}">
			<intranda:breadcrumb id="processAll" label="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.aktuelleProzesse:msgs.prozessvorlagen}" action="process_all" navId="a1" />
			<intranda:breadcrumb id="processEdit" label="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.prozessDetails:msgs.process_templateDetails}" action="process_edit" />
		</c:if>
        
        <c:if test="#{NavigationForm.uiStatus.pluginSimulation != true}">
		    <intranda:breadcrumb label="#{msgs.aktuelleSchritte}" action="#{AktuelleSchritteForm.paginator.returnToPreviousPage}" />
    	   	<intranda:breadcrumb label="#{AktuelleSchritteForm.mySchritt.prozess.titel}" action="#{AktuelleSchritteForm.myPlugin.cancel}" />
		</c:if>
        
        <intranda:breadcrumb label="#{myPageTitle}" noSeparator="#{true}" />
    </ui:define>

    <ui:define name="info">
    </ui:define>

    <ui:define name="content">
    
        <link rel="stylesheet" href="imageQA.css" />
        <style>
			/* Thumbnails */
			.goobi-thumbnail {
			    float: left;
			    margin: 7px;
			    width: #{AktuelleSchritteForm.myPlugin.thumbnailSize +2}px;
			    height: #{AktuelleSchritteForm .myPlugin.thumbnailSize+55}px;
			}
			
			.goobi-thumbnail .goobi-thumbnail-image {
			    float: left;
			    width: 100%;
			    min-height: 100px;
			    overflow: hidden;
			    max-height: #{AktuelleSchritteForm.myPlugin.thumbnailSize +2}px;
			}
			

		</style>
        
		<script src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/reactiveX/rx.lite.min.js"></script>
		<script src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/q-promises/q.min.js"></script>

		<script src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/openseadragon/openseadragon.min.js"></script>
		<script	src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/openseadragon/openseadragon-viewerinputhook.js"></script>
		
    <!-- 3D-Models -->
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/three.min.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/loaders/OBJLoader.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/loaders/MTLLoader.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/loaders/PLYLoader.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/loaders/STLLoader.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/loaders/FBXLoader.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/loaders/TDSLoader.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/loaders/DRACOLoader.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/loaders/GLTFLoader.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/controls/OrbitControls.js"></script>
		<script type="text/javascript" src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/three/dependencies/inflate.min.js"></script>
   		<script src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/x3dom/x3dom.js"></script>
   		
   		<script src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/imageView.min.js"></script>
    	<script src="#{HelperForm.applicationWebsiteUrl}/uii/template/js/objectView.min.js"></script>
   		

        <h:form id="qaform">
            <div class="box box-color lightgrey box-bordered">
                <div class="box-title">
                    <h3>
                        <i class="fa fa-puzzle-piece" />
                        <h:outputText id="id9a" value="#{AktuelleSchritteForm.myPlugin.step.titel}" />
                    </h3>
                    <div class="actions">
                    	<h:commandLink 
                    		styleClass="btn font-size-s margin-left-10" 
                    		title="#{msgs.imageFullscreen}"
							action="ImageQAPlugin_JSFullscreen" 
							rendered="#{AktuelleSchritteForm.myPlugin.thumbnailsOnly and AktuelleSchritteForm.myPlugin.useJSFullscreen}">
							<i class="fa fa-arrows-alt"></i>
						</h:commandLink>
						<h:commandLink
                            styleClass="btn font-size-s margin-left-10"
                            title="#{msgs.imageFullscreen}"
                            action="ImageQAPlugin_Fullscreen"
                            rendered="#{AktuelleSchritteForm.myPlugin.thumbnailsOnly and not AktuelleSchritteForm.myPlugin.useJSFullscreen}">
                            <i class="fa fa-arrows-alt"></i>
                        </h:commandLink>
                        <h:commandLink id="id10" action="#{NavigationForm.Reload}" styleClass="btn btn-mini">
                            <i class="fa fa-refresh" />
                        </h:commandLink>
                        
                        <h:commandLink id="id11" action="#{AktuelleSchritteForm.SchrittDurchBenutzerAbschliessen}" styleClass="btn btn-mini" 
                        	rendered="#{NavigationForm.uiStatus.pluginSimulation != true and AktuelleSchritteForm.myPlugin.allowTaskFinishButtons == true}" title="#{msgs.task_leavePluginAndFinishTask}">
                            <i class="fa fa-check" />
                            <x:updateActionListener property="#{NavigationForm.uiStatus.pluginSimulation}" value="#{false}" />
                        </h:commandLink>
                        
                        <h:commandLink id="id12" action="#{AktuelleSchritteForm.myPlugin.cancel}" styleClass="btn btn-mini" 
                        	rendered="#{NavigationForm.uiStatus.pluginSimulation != true and AktuelleSchritteForm.myPlugin.allowTaskFinishButtons == true}" title="#{msgs.pluginLeave}">
                            <i class="fa fa-close" />
                            <x:updateActionListener property="#{NavigationForm.uiStatus.pluginSimulation}" value="#{false}" />
                        </h:commandLink>
                        
                    </div>
                </div>

                <div class="box-content">
					<div class="#{AktuelleSchritteForm.myPlugin.thumbnailsOnly ? 'col-sm-12' : AktuelleSchritteForm.myPlugin.displayOCR ? 'col-sm-5' : 'col-sm-7'} col-xs-12">
						<h:panelGroup layout="block" rendered="#{AktuelleSchritteForm.myPlugin.sizeOfImageList gt 0}">

                        <div class="row">
                            <f:subview id="first">
                                <ui:param name="position" value="first"></ui:param>
                                <ui:include src="ImageQAPlugin_include_thumbnavigation.xhtml" />
                            </f:subview>
                        </div>

                        <!-- Thumbnail list -->
                        <div class="flex-container margin-top-most margin-bottom-most" dir="#{AktuelleSchritteForm.myPlugin.flowDir}">

                            <ui:repeat var="image" value="#{AktuelleSchritteForm.myPlugin.paginatorList}" varStatus="status">
                                <div class="goobi-thumbnail #{AktuelleSchritteForm.myPlugin.image.imageName eq image.imageName?'img-active':'font-light'}" dir="auto">
                                    <div class="goobi-thumbnail-image">

                                        <div class="thumb">
                                            <h:commandLink title="#{image.tooltip}" action="#{AktuelleSchritteForm.myPlugin.imageClick}">
	                                            <ui:fragment rendered="#{image.type == 'image'}">
	                                                <canvas class="thumb-canvas" data-image_small="#{image.thumbnailUrl}" data-image_large="#{image.largeThumbnailUrl}" title="#{image.tooltip}" id="thumbnail-#{status.index}"></canvas>

												</ui:fragment>
												<!-- 3D OBJECT -->
			                                    <ui:fragment rendered="#{image.type == 'object' or image.type == 'x3dom'}">
			                                        <img 
			                                            class="thumbnails__thumb-placeholder"
			                                            src="#{HelperForm.servletPathWithHostAsUrl}/uii/template/img/goobi_3d_object_placeholder.png" />
			                                    </ui:fragment>
			                                    <!-- PLACEHOLDER -->
			                                    <ui:fragment rendered="#{image.type != 'image' and image.type != 'object' and  image.type != 'x3dom'}">
			                                        <img 
			                                            class="thumbnails__thumb-placeholder"
			                                            src="#{HelperForm.servletPathWithHostAsUrl}/uii/template/img/thumbnail-placeholder.png" />
			                                    </ui:fragment>
			                                    <f:setPropertyActionListener value="#{image.order -1}" target="#{AktuelleSchritteForm.myPlugin.imageIndex}" />
	                                            <f:ajax execute="@form" render="@form :qaform:bigimage" onevent="freeJSResources" disabled="#{AktuelleSchritteForm.myPlugin.thumbnailsOnly}"/>
                                            </h:commandLink>
                                        </div>

                                    </div>
                                    <div class="goobi-thumbnail-caption">
                                        <h:outputText value="#{image.imageNameShort}"></h:outputText>
                                    </div>

                                    <h:panelGroup styleClass="goobi-thumbnail-controls" rendered="#{NavigationForm.uiStatus.plugin_qa_confirmation == false}">

                                        <div class="goobi-thumbnail-controls-left pull-left">
                                            <!-- select current image -->
                                            <h:panelGroup rendered="#{AktuelleSchritteForm.myPlugin.allowSelection}">
                                                <span class="btn thumbnail-control checkbox">
                                                    <label class="control checkbox">
                                                        <h:selectBooleanCheckbox value="#{image.selected}" />
                                                        <span class="control-indicator">
                                                            <i class="fa fa fa-check-square-o"></i>
                                                            <i class="fa fa fa-square-o"></i>
                                                        </span>
                                                    </label>

                                                </span>
                                            </h:panelGroup>
                                            <!--  modal rendern  -->
                                            <h:panelGroup rendered="#{AktuelleSchritteForm.myPlugin.allowRenaming}">
                                                <a class="btn thumbnail-control rename" title="#{msgs.plugin_intranda_step_imageQA_rename} #{image.tooltip}" href="#" data-toggle="modal" data-target="#myModal-#{status.index}">
                                                    <i class="fa fa-pencil" />
                                                </a>
                                            </h:panelGroup>
                                            <h:commandLink styleClass="btn thumbnail-control delete" title="#{msgs.plugin_intranda_step_imageQA_delete} #{image.tooltip}" action="#{AktuelleSchritteForm.myPlugin.deleteImage(image)}" rendered="#{AktuelleSchritteForm.myPlugin.allowDeletion}">
                                                <i class="fa fa-trash"></i>
                                            </h:commandLink>
                                        </div>
                                        <div class="goobi-thumbnail-controls-right pull-right">
                                        <h:commandLink styleClass="btn thumbnail-control rotate-left" title="#{msgs.plugin_intranda_step_imageQA_rotateLeft} #{image.tooltip}" action="#{AktuelleSchritteForm.myPlugin.rotateLeft(image)}" rendered="#{AktuelleSchritteForm.myPlugin.allowRotation}">
                                            <i class="fa fa-undo"></i>
                                        </h:commandLink>
                                    	<h:commandLink styleClass="btn thumbnail-control rotate-right" title="#{msgs.plugin_intranda_step_imageQA_rotateRight} #{image.tooltip}" action="#{AktuelleSchritteForm.myPlugin.rotateRight(image)}" rendered="#{AktuelleSchritteForm.myPlugin.allowRotation}">
                                            <i class="fa fa-repeat"></i>
                                        </h:commandLink>
                                        </div>
                                    </h:panelGroup>

                                    <h:panelGroup styleClass="goobi-thumbnail-controls" rendered="#{NavigationForm.uiStatus.plugin_qa_confirmation != false}">
                                        <div class="goobi-thumbnail-controls-left pull-left">
                                            <!-- select current image -->
                                            <h:panelGroup rendered="#{AktuelleSchritteForm.myPlugin.allowSelection}">
                                                <span class="btn thumbnail-control checkbox">
                                                    <label class="control checkbox">
                                                        <h:selectBooleanCheckbox value="#{image.selected}" />
                                                        <span class="control-indicator">
                                                            <i class="fa fa fa-check-square-o"></i>
                                                            <i class="fa fa fa-square-o"></i>
                                                        </span>
                                                    </label>

                                                </span>
                                            </h:panelGroup>

                                            <!--  modal rendern  -->
                                            <h:panelGroup rendered="#{AktuelleSchritteForm.myPlugin.allowRenaming}">
                                                <a class="btn thumbnail-control rename" title="#{msgs.plugin_intranda_step_imageQA_rename} #{image.tooltip}" href="#" data-toggle="modal" data-target="#myModal-#{status.index}">
                                                    <i class="fa fa-pencil" />
                                                </a>
                                            </h:panelGroup>
                                            <h:commandLink styleClass="btn thumbnail-control delete" title="#{msgs.plugin_intranda_step_imageQA_delete} #{image.tooltip}" action="#{AktuelleSchritteForm.myPlugin.deleteImage(image)}" rendered="#{AktuelleSchritteForm.myPlugin.allowDeletion}" onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                <i class="fa fa-trash"></i>
                                            </h:commandLink>
                                        </div>

                                        <div class="goobi-thumbnail-controls-right pull-right">
                                            <h:commandLink styleClass="btn thumbnail-control rotate-left" title="#{msgs.plugin_intranda_step_imageQA_rotateLeft} #{image.tooltip}" action="#{AktuelleSchritteForm.myPlugin.rotateLeft(image)}" rendered="#{AktuelleSchritteForm.myPlugin.allowRotation}" onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                <i class="fa fa-undo"></i>
                                            </h:commandLink>
                                         	<h:commandLink styleClass="btn thumbnail-control rotate-right" title="#{msgs.plugin_intranda_step_imageQA_rotateRight} #{image.tooltip}" action="#{AktuelleSchritteForm.myPlugin.rotateRight(image)}" rendered="#{AktuelleSchritteForm.myPlugin.allowRotation}" onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
                                                <i class="fa fa-repeat"></i>
                                            </h:commandLink>
                                        </div>
                                    </h:panelGroup>

                                </div>

                                <div class="modal fade" id="myModal-#{status.index}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <a href="#" class="btn btn-blue pull-right" title="#{msgs.cancel}" data-dismiss="modal">
                                                    <i class="fa fa-times"></i>
                                                </a>
                                                <h4 class="modal-title" id="myModalLabel">
                                                    <h:outputText value="#{msgs.plugin_intranda_step_imageQA_renameTitle}: #{image.imageName}" />
                                                </h4>
                                            </div>
                                            <div class="modal-body">
                                                <h:outputText value="#{msgs.plugin_intranda_step_imageQA_renameDescription}" />

                                                <div class="row" style="margin-top: 15px;">
	                                                    <ui:repeat var="namePart" value="#{image.nameParts}">
		                                                    	<x:inputText styleClass="form-control namePart" value="#{namePart.value}" />
	                                                    </ui:repeat>
                                                </div>

                                            </div>
                                            <div class="modal-footer">

                                                <a href="#" class="btn pull-left font-size-s" title="#{msgs.abbrechen}" data-dismiss="modal">
                                                    <h:outputText value="#{msgs.abbrechen}" />
                                                </a>

                                                <h:commandLink action="#{AktuelleSchritteForm.myPlugin.renameImages(image)}" title="#{msgs.uebernehmen}" rel="tooltip" styleClass="btn btn-green font-size-s">
                                                    <i class="fa fa-floppy-o margin-right-10"></i>
                                                    <h:outputText value="#{msgs.uebernehmen}" />
                                                    <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                                </h:commandLink>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                         
                            </ui:repeat>
                        </div>
                        <!-- // Thumbnail list -->

                        <div class="row">
                            <f:subview id="second">
                                <ui:param name="position" value="second"></ui:param>
                                <ui:include src="ImageQAPlugin_include_thumbnavigation.xhtml" />
                            </f:subview>
                        </div>

                    </h:panelGroup>
					</div>

					<h:panelGroup 
						rendered="#{AktuelleSchritteForm.myPlugin.sizeOfImageList gt 0 and not AktuelleSchritteForm.myPlugin.thumbnailsOnly}" 
						class="#{AktuelleSchritteForm.myPlugin.displayOCR ? 'col-xs-12 col-sm-7' : 'col-xs-12 col-sm-5'}"
						layout="block">
                        <h:panelGroup id="bigimage">

                            <div class="row pull-center">
                                <f:subview id="first_image">
                                    <ui:include src="ImageQAPlugin_include_imagenavigation.xhtml" />
                                </f:subview>
                                <ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'image'}">
                                    <ui:include src="ImageQAPlugin_include_imageControls.xhtml" />
                                </ui:fragment>
                                <ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'object'}">
                                    <ui:include src="ImageQAPlugin_include_objectControls.xhtml" />
                                </ui:fragment>
                            </div>

                            <!-- big image -->
                            
                            <ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'audio'}">
                                <div class="row margin-top-most margin-bottom-most">
                                <audio
                                    class="audioplayer"
                                    id="audioplayer"
                                    controls="true"
                                    played="length"
                                    preload="auto"
                                    src="#{AktuelleSchritteForm.myPlugin.image.objectUrl}">
                                </audio>
                                </div>
                            </ui:fragment>

                            <ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'video'}">
                                <div class="row margin-top-most margin-bottom-most">
                                <video
                                    class="videoplayer"
                                    id="videoplayer"
                                    controls="true"
                                    played="length"
                                    preload="auto"
                                    src="#{AktuelleSchritteForm.myPlugin.image.objectUrl}">
                                </video>
                                </div>
                            </ui:fragment>

                            <ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'unknown'}">
                                <div class="row margin-top-most margin-bottom-most">
                                <p class="unknown_file_download">
                                    <h:outputText value="#{msgs.mets_downloadFile}" />
                                    <a
                                        href="#{AktuelleSchritteForm.myPlugin.image.objectUrl}"
                                        download="#{AktuelleSchritteForm.myPlugin.image.tooltip}">Download</a>
                                </p>
								</div>
                            </ui:fragment>


                            <ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.image.type == 'image'}">
                            
                            <div class="row margin-top-most margin-bottom-most">
									<div class="#{AktuelleSchritteForm.myPlugin.displayOCR ? 'col-xs-12 col-sm-6' : ''}">							
										<div class="div-image">
                                    <div id="mainImage" class="margin-bottom-regular">
                                        <div id="ajaxloader_image">
                                            <img src="template/img/goobi/ajaxloader2.gif" />
                                        </div>
                                    </div>
                                    <div class="big-image-caption margin-top-regular font-light">
                                        <h:outputText value="#{AktuelleSchritteForm.myPlugin.image.imageName}" />
                                    </div>
                                    
                            </div>
	                                </div>
	                               <!-- OCR text -->
									<ui:fragment rendered="#{AktuelleSchritteForm.myPlugin.displayOCR}">
										<div class="col-xs-12 col-sm-6 border-light">
											<div id="ocrText" class="ocr-text">	
											<h:outputText value="#{AktuelleSchritteForm.myPlugin.ocrText}" escape="false">
											</h:outputText>
											</div>
										</div>
									</ui:fragment>
									<!--  OCR text -->
								</div>
                            <!-- // big image -->
                            <div class="row">
                                <f:subview id="second_image">
                                    <ui:include src="ImageQAPlugin_include_imagenavigation.xhtml" />
                                </f:subview>
                            </div>

                            </ui:fragment>
                            <script type="text/javascript">
                                        var configViewer = {
                                            global: {
                                                divId: 'mainImage',
                                                useTiles: #{AktuelleSchritteForm.myPlugin.useTiles},
                                                footerHeight: 0,
                                                adaptContainerHeight: true,
                                                zoomSlider: "#zoomSlider",
                                                zoomSliderHandle: "#zoomSlider .zoom-slider-handle",
                                                zoomSliderLabel: "#zoomSliderLabel input",
                                                webApiToken: '#{AktuelleSchritteForm.myPlugin.imageWebApiToken}',
                                                imageSizes: #{AktuelleSchritteForm.myPlugin.displaySizes},
                                                tileSizes: #{AktuelleSchritteForm.myPlugin.tileSize}
                                            },
                                            image: {
                                                mimeType: "image/jpeg",
                                                tileSource: "#{AktuelleSchritteForm.myPlugin.image.url}"
//                                                  tileSource : [#{AktuelleSchritteForm.myPlugin.image.imageLevels}],
//                                                  originalImageWidth: "#{AktuelleSchritteForm.myPlugin.image.size.width}",
//                                                  originalImageHeight: "#{AktuelleSchritteForm.myPlugin.image.size.height}",
                                            }
                                        };                                  
                                        
                                        var worldConfig = {
                                                controls: {
                                                    xAxis: {
                                                        rotateLeft: '#rotate-left-x',
                                                        rotateRight: '#rotate-right-x'
                                                    },
                                                   yAxis: {
                                                        rotateLeft: '#rotate-left-y',
                                                        rotateRight: '#rotate-right-y'
                                                    },
                                                   zAxis: {
                                                        rotateLeft: '#rotate-left-z',
                                                        rotateRight: '#rotate-right-z'
                                                    },
                                                    position: {
                                                        reset: '#reset-position'   
                                                    },
                                                    zoom: {
                                                        resetZoom: '#reset#zoom'
                                                    }
                                                },
                                                container: {
                                                    id: "mainImage"
                                                },
                                         };
                                        
                                        var mediaType = "#{AktuelleSchritteForm.myPlugin.image.type}";
                                        if(mediaType == "image") {
                                            
                                            var viewImage = new ImageView.Image( configViewer );
                                            viewImage.load()
                                            .then(function(image) {
                                                image.onFirstTileLoaded()
                                                .then(function() {                                                  
                                                    $('#ajaxloader_image').fadeOut(800);
                                                })
                                                .catch(function() {
                                                    $('#ajaxloader_image').fadeOut(800);
                                                })
                                            })
                                            .catch(function(error){
                                                console.error( 'Error opening image', error );
                                                $('#ajaxloader_image').fadeOut(800);
                                                $('#' + configViewer.global.divId).html( 'Failed to load image: "' + error + '"' );
                                            });
                                        
                                        } else if(mediaType == "object") {
                                           $('#ajaxloader_image').show();
                                            var world = WorldGenerator.create(worldConfig);
                                            world.loadObject({
                                                 url: "#{AktuelleSchritteForm.myPlugin.image.objectUrl}",
                                                 position: { x:0, y:0, z:-0 },
                                                 rotation:  { x:0, y:0, z:0 },
                                                 size:  10,
                                                 material: {
                                                        color: 0x44bb33
                                                    },
                                                focus: true,
                                                onTick: function(object, time) {
                                                    if(object) {
//                                                      object.rotation.set(0,  Math.PI/180 * time, 0);
                                                    }
                                                }
                                             }).then(function(object) {
                                                 $('#ajaxloader_image').fadeOut(2000);
                                                world.render();
                                             }).catch(function(error) {
                                                $('#ajaxloader_image').fadeOut(2000);
                                                 console.err("failed to load: ", error);
                                             })
                                            
                                        } else if(mediaType == "x3dom") {
                                            var objectUrl = "#{AktuelleSchritteForm.myPlugin.image.objectUrl}";
                                           $('#ajaxloader_image').show();
                                                new X3DLoader().load($('#mainImage'), objectUrl, 
                                                    function(){
                                                        $('#ajaxloader_image').fadeOut(2000);
//                                                      console.log("loaded")
                                                    },
                                                   function(){
//                                                     console.log("progress");
                                                    },
                                                   function(error){
                                                       $('#ajaxloader_image').fadeOut(2000);
                                                       console.err("error", error);
                                                    })
                                        }
                                        
                                         function freeJSResources(data) {
                                                if(!data || data.status == 'begin') {                                               
                                                    if(viewImage) {
//                                                      console.log("closing OpenSeadragon viewer");
                                                        viewImage.close();
                                                    }
                                                    if(world) {
//                                                      console.log("disposing 3d scene");
                                                        world.dispose();
                                                    }
                                                }
                                            }
                                    </script>
                        </h:panelGroup>
                    </h:panelGroup>
                    <h:panelGroup layout="block" rendered="#{AktuelleSchritteForm.myPlugin.sizeOfImageList == 0}" styleClass="col-sm-12">
                        <h:outputText value="#{msgs.noImagesFound}" />
                    </h:panelGroup>
                </div>

                <div class="form-actions">

                    <!-- Save and finish the task -->
					<h:commandLink styleClass="btn btn-green font-size-s" id="finishAndClose" rendered="#{NavigationForm.uiStatus.pluginSimulation != true and AktuelleSchritteForm.myPlugin.allowTaskFinishButtons == true}" action="#{AktuelleSchritteForm.SchrittDurchBenutzerAbschliessen}">
                        <i class="fa fa-check margin-right-5"></i>
                        <h:outputText value="#{msgs.task_leavePluginAndFinishTask}" />
                        <x:updateActionListener property="#{NavigationForm.uiStatus.pluginSimulation}" value="#{false}" />
                    </h:commandLink>
                     
                    <!-- Save -->
                    <h:commandLink styleClass="btn btn-lightgrey pull-right font-size-s" id="absenden" action="#{AktuelleSchritteForm.myPlugin.cancel}">
                        <i class="fa fa-close margin-right-5"></i>
                        <h:outputText value="#{msgs.pluginLeave}" />
                        <x:updateActionListener property="#{NavigationForm.uiStatus.pluginSimulation}" value="#{false}" />
                    </h:commandLink>

                </div>

            </div>

        </h:form>


        <script type="text/javascript">
	        	
        	window.onload = function() {
		    	loadImages();
		    }
			
			function loadThumbnails() {
				var height = parseInt('#{AktuelleSchritteForm.myPlugin.thumbnailSize}');
				if (height) {
		     		$('.goobi-thumbnail-image').css('height', (height + 25) + 'px');
		    		$('.goobi-thumbnail-image .thumb').css('max-height', height + 'px');
		    		$('.goobi-thumbnail-image .thumb canvas').css('max-height', height + 'px');
		    		$('.goobi-thumbnail-image').css('max-width', (height) + 'px');
				}
			}
		
			$( document ).ready(function() {
				loadThumbnails();
			});
		
			jsf.ajax.addOnEvent(function(data) {
		    	var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
		      	switch (ajaxstatus) {
		        	case "success": // This is called when ajax response is successfully processed.
		            	loadImages();
		            	loadThumbnails();
		              	break;
		      		}
			});
		
			function copyValue(element, e) {
		    	console.log(element.id);
		    	if (element.id =='qaform:first:txtMoveTo2') {
		        	document.getElementById('qaform:second:txtMoveTo2').value = element.value;
		    	} else if (element.id =='qaform:second:txtMoveTo2'){
		        	document.getElementById('qaform:first:txtMoveTo2').value = element.value;
		    	} else if (element.id =='qaform:first_image:txtImageMoveTo2') {
		        	document.getElementById('qaform:second_image:txtImageMoveTo2').value = element.value;
		    	} else {
		        	document.getElementById('qaform:first_image:txtImageMoveTo2').value = element.value;
		    	}
		    
			    var keycode;
				if (window.event)
					keycode = window.event.keyCode;
				else if (e)
					keycode = e.which;
				else
					return true;
			
				if (keycode == 13) {
					document.getElementById(element.id).nextSibling.click();
					return false;
				} else
					return true;
			}
			
			$(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+right', function() {            	
            	var myButton = document.getElementById("qaform:first_image:imageNext");
            	if (myButton!=null) {
            		myButton.click();
            	} 
            });
            
            $(document).bind('keyup', '#{LoginForm.myBenutzer.shortcutPrefix}+left', function() {            	
            	var myButton = document.getElementById("qaform:first_image:imageBack");
            	if (myButton!=null) {
            		myButton.click();
            	} 
            });
            
         	// Find the right method, call on correct element
            function launchFullScreen(element) {
              if(element.requestFullScreen) {
                element.requestFullScreen();
              } else if(element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
              } else if(element.webkitRequestFullScreen) {
                element.webkitRequestFullScreen();
              }
            }

	</script>
    </ui:define>

</ui:composition>